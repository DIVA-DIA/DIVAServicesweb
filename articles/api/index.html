<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <title>DIVAServices API Endpoints - DIVAServices
    </title>
    <link rel="stylesheet" href="/DIVAServicesweb/styles/main.css">
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Merriweather">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.14.0/themes/prism-tomorrow.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.10/css/all.css" integrity="sha384-+d0P83n9kaQMCwj8F4RJB66tzIwOKmrdb46+porD/OvrJ+37WqIM7UoBtwHO6Nlg" crossorigin="anonymous">
  </head>
  <body>
    <div class="container nav">
      <div class="larger">
        <nav>
          <ul class="left">
            <li><a href="/DIVAServicesweb/">DIVAServices</a></li>
          </ul>
          <ul class="right">
            <li><a href="/DIVAServicesweb/articles.html">Tutorials</a></li>
          </ul>
        </nav>
      </div>
    </div>
    <div class="container header">
      <div class="larger">
        <header class="is-small">
          <h2>DIVAServices API Endpoints</h2>
        </header>
      </div>
    </div>
    <div class="container md-content">
      <div class="larger">
        <aside>
          <h2>Basic</h2>
          <ul>
            <li><a href="/DIVAServicesweb/articles/core">Core Principles</a></li>
            <li><a href="/DIVAServicesweb/articles/architecture">Architecture</a></li>
            <li><a href="/DIVAServicesweb/articles/basic-example">Basic Example</a></li>
            <li><a href="/DIVAServicesweb/articles/api">API Endpoints</a></li>
          </ul>
          <h2>Intermediate</h2>
          <h2>Advanced</h2>
          <ul>
            <li><a href="/DIVAServicesweb/articles/provide-your-method">Provide your method</a></li>
          </ul>
          <h2>Applications</h2>
          <ul>
            <li><a href="/DIVAServicesweb/articles/spotlight">DIVAServices-Spotlight</a></li>
          </ul>
        </aside>
        <section class="md-container"><h1 id="api-endpoints"><span class="caps">API</span>&nbsp;Endpoints</h1>
<ul>
<li><a href="#api-endpoints"><span class="caps">API</span> Endpoints</a><ul>
<li><a href="#root-endpoint">Root Endpoint</a><ul>
<li><a href="#get"><span class="caps">GET</span>&nbsp;/</a></li>
</ul>
</li>
<li><a href="#method-endpoints">Method Endpoints</a><ul>
<li><a href="#get---type--methodname"><span class="caps">GET</span>&nbsp;/:type/:methodname</a></li>
<li><a href="#post---type--methodname"><span class="caps">POST</span> /:type/:methodname</a><ul>
<li><a href="#request-body">Request-Body</a></li>
<li><a href="#request-response">Request-Response</a></li>
<li><a href="#fetching-for-results">Fetching For&nbsp;Results</a></li>
<li><a href="#example">Example</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#data---collection-endpoints">Data / Collection Endpoints</a><ul>
<li><a href="#get--collections"><span class="caps">GET</span>&nbsp;/collections</a></li>
<li><a href="#post--collections"><span class="caps">POST</span>&nbsp;/collections</a></li>
<li><a href="#get--collections--collectionname"><span class="caps">GET</span>&nbsp;/collections/:collectionname</a></li>
<li><a href="#put--collections--collectionname"><span class="caps">PUT</span>&nbsp;/collections/:collectionname</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="root-endpoint">Root&nbsp;Endpoint</h2>
<h3 id="get-"><span class="caps">GET</span>&nbsp;/</h3>
<p>The root (<a href="http://divaservices.unifr.ch/api/v2/">http://divaservices.unifr.ch/api/v2/</a>) provides information about all available methods. The response will look as&nbsp;follows:</p>
<pre><code class="lang-JSON">[
  {
    <span class="attr">"name"</span>: <span class="string">"Otsu Binarization"</span>,
    <span class="attr">"description"</span>: <span class="string">"Otsu Binarization"</span>,
    <span class="attr">"type"</span>: <span class="string">"binarization"</span>,
    <span class="attr">"url"</span>: <span class="string">"http://divaservices.unifr.ch/api/v2/binarization/otsubinarization/1"</span>
  },
  {
    <span class="attr">"name"</span>: <span class="string">"<span class="caps">HOOSC</span> Feature Extraction"</span>,
    <span class="attr">"description"</span>: <span class="string">"This code extracts Histogram of Orientation Shape Context (<span class="caps">HOOSC</span>) local shape descriptor from an input hieroglyph image."</span>,
    <span class="attr">"type"</span>: <span class="string">"imageprocessing"</span>,
    <span class="attr">"url"</span>: <span class="string">"http://divaservices.unifr.ch/api/v2/imageprocessing/hooscfeatureextraction/1"</span>
  }
]
</code></pre>
<p>Each method is described in an object containing the following four data&nbsp;points:</p>
<ul>
<li><code>name</code>: The name of the&nbsp;method</li>
<li><code>description</code>: A description of the&nbsp;method</li>
<li><code>type</code>: A classification of the type of the&nbsp;method</li>
<li><code>url</code>: The <span class="caps">URL</span> pointing to the endpoint for the&nbsp;method</li>
</ul>
<h2 id="method-endpoints">Method&nbsp;Endpoints</h2>
<h3 id="get-type-methodname"><span class="caps">GET</span>&nbsp;/:type/:methodname</h3>
<p>Provides information about a specific information. The response looks as&nbsp;follows:</p>
<pre><code class="lang-JSON">{
  <span class="attr">"general"</span>: {
    <span class="attr">"name"</span>: <span class="string">"Otsu Binarization"</span>,
    <span class="attr">"description"</span>: <span class="string">"Otsu Binarization"</span>,
    <span class="attr">"developer"</span>: <span class="string">"Marcel Würsch"</span>,
    <span class="attr">"affiliation"</span>: <span class="string">"University of Fribourg"</span>,
    <span class="attr">"email"</span>: <span class="string">"marcel.wuersch@unifr.ch"</span>,
    <span class="attr">"author"</span>: <span class="string">"Marcel Würsch"</span>,
    <span class="attr">"<span class="caps">DOI</span>"</span>: <span class="string">"10.1117/12.783598"</span>,
    <span class="attr">"type"</span>: <span class="string">"binarization"</span>,
    <span class="attr">"license"</span>: <span class="string">"Other"</span>,
    <span class="attr">"ownsCopyright"</span>: <span class="string">"1"</span>,
    <span class="attr">"expectedRuntime"</span>: <span class="number">2.258397932816539</span>,
    <span class="attr">"executions"</span>: <span class="number">387</span>
  },
  <span class="attr">"input"</span>: [
    {
      <span class="attr">"file"</span>: {
        <span class="attr">"name"</span>: <span class="string">"inputImage"</span>,
        <span class="attr">"description"</span>: <span class="string">"The input image to binarize"</span>,
        <span class="attr">"options"</span>: {
          <span class="attr">"required"</span>: <span class="literal">true</span>,
          <span class="attr">"mimeTypes"</span>: {
            <span class="attr">"allowed"</span>: [
              <span class="string">"image/jpeg"</span>,
              <span class="string">"image/png"</span>,
              <span class="string">"image/tiff"</span>
            ],
            <span class="attr">"default"</span>: <span class="string">"image/jpeg"</span>
          }
        },
        <span class="attr">"userdefined"</span>: <span class="literal">true</span>
      }
    },
    {
      <span class="attr">"outputFolder"</span>: {
        <span class="attr">"userdefined"</span>: <span class="literal">false</span>
      }
    }
  ],
  <span class="attr">"output"</span>: [
    {
      <span class="attr">"file"</span>: {
        <span class="attr">"name"</span>: <span class="string">"otsuBinaryImage"</span>,
        <span class="attr">"type"</span>: <span class="string">"image"</span>,
        <span class="attr">"description"</span>: <span class="string">"Generated Binary Image"</span>,
        <span class="attr">"options"</span>: {
          <span class="attr">"mimeTypes"</span>: {
            <span class="attr">"allowed"</span>: [
              <span class="string">"image/jpeg"</span>,
              <span class="string">"image/png"</span>,
              <span class="string">"image/tiff"</span>
            ],
            <span class="attr">"default"</span>: <span class="string">"image/jpeg"</span>
          },
          <span class="attr">"colorspace"</span>: <span class="string">"binary"</span>,
          <span class="attr">"visualization"</span>: <span class="literal">true</span>
        }
      }
    }
  ]
}
</code></pre>
<p>The <span class="caps">JSON</span> object is built of the following&nbsp;structure:</p>
<ul>
<li><code>general</code>: Contains general information about the method (e.g. author of the method, or <span class="caps">DOI</span> for referencing in scientific&nbsp;publications)</li>
<li><code>input</code>: A <span class="caps">JSON</span> array specifying the inputs required by the&nbsp;method.</li>
<li><code>output</code>: A <span class="caps">JSON</span> array specifiying the outputs generated by the&nbsp;method.</li>
</ul>
<p>The <code>input</code> and <code>output</code> array are further specified in the Tutorial on <a href="/DIVAServicesweb/articles/inputs-and-outputs">Inputs and&nbsp;Outputs</a></p>
<h3 id="post-type-methodname"><span class="caps">POST</span>&nbsp;/:type/:methodname</h3>
<p>A <span class="caps">POST</span> request to the URL of a method starts the execution of a method.
The POST request needs to contain a <code>request-body</code> that contains all necessary data needed by the&nbsp;method.</p>
<h4 id="request-body">Request-Body</h4>
<p><strong>Important:</strong> All <span class="caps">POST</span> request need to set the <code>content-type</code> to <code>application/json</code>. Otherwise they will be rejected by&nbsp;DIVAServices.</p>
<p>The <code>request-body</code> has the following&nbsp;structure:</p>
<pre><code class="lang-JSON">{
  <span class="attr">"parameters"</span>:{},
  <span class="attr">"data"</span>:[
    {
    }
  ]
}
</code></pre>
<p>The <code>parameter</code> object will contain all regular parameter values, and the <code>data</code> array all input data related information. For mor information check out the tutorial on <a href="/DIVAServicesweb/articles/inputs-and-outputs">Inputs and Outputs</a>.</p>
<h4 id="request-response">Request-Response</h4>
<p>The <span class="caps">POST</span> request will return an immediate response with the following&nbsp;structure:</p>
<pre><code class="lang-JSON">{
  <span class="attr">"results"</span>: [
    {
      <span class="attr">"resultLink"</span>: <span class="string">"http://divaservices.unifr.ch/api/v2/results/majorknowledgeableconey/data_0/data_0.json"</span>
      }
  ],
  <span class="attr">"statusCode"</span>: <span class="number">202</span>
}
</code></pre>
<p>The <code>results</code> array will contain an object with a <code>resultLink</code> for each <code>data</code> element that was used in the <span class="caps">POST</span> request. This <code>resultLink</code> <span class="caps">URL</span> will contain the actual result of the specific method&nbsp;call.</p>
<h4 id="fetching-for-results">Fetching For&nbsp;Results</h4>
<p>Since the requests are executed asynchronously, the client will have to poll for the results. As stated above, the client will receive a <span class="caps">JSON</span> response to the POST request that starts the execution of the&nbsp;method.</p>
<p>The response will either containt <code>status: &quot;planned&quot;</code> or <code>status: &quot;done&quot;</code> which can be used to identify whether or not the execution is&nbsp;finished.</p>
<p>The following Python and JavaScript functions serve as examples how polling can&nbsp;work:</p>
<p><strong>Python</strong></p>
<pre><code class="lang-Python"><span class="function"><span class="keyword">def</span> <span class="title">pollResult</span><span class="params">(self, result_link)</span>:</span>
    <span class="string">""" Polls for the result of the execution in 1s intervals 
    Arguments:
        result_link {string} -- [the resultLink generated by the <span class="caps">POST</span> request that started the execution]

    Returns:
        [json] -- [the result of the execution]
    """</span>

    response = json.loads(requests.request(<span class="string">"<span class="caps">GET</span>"</span>, result_link).text)
    <span class="keyword">while</span>(response[<span class="string">'status'</span>] != <span class="string">'done'</span>):
        <span class="keyword">if</span>(response[<span class="string">'status'</span>] == <span class="string">'error'</span>):
            sys.stderr.write(<span class="string">'Error in executing the request. See the log file at: '</span> + response[<span class="string">'output'</span>][<span class="number">0</span>][<span class="string">'file'</span>][<span class="string">'url'</span>])
            sys.exit()
        time.sleep(<span class="number">1</span>)
        response = json.loads(requests.request(<span class="string">"<span class="caps">GET</span>"</span>, result_link).text)
    <span class="keyword">return</span> response

</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="lang-JavaScript"><span class="comment">/**
  * 
  * Fetch the result from a given url
  * Polls for the result every 1000ms (1s)
  *  
 * */</span>
<span class="function"><span class="keyword">function</span> <span class="title">getResult</span>(<span class="params">url</span>) </span>{
    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> {
        fetch(url, {
            <span class="attr">method</span>: <span class="string">"<span class="caps">GET</span>"</span>
        }).then(<span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>{
            <span class="keyword">return</span> res.json();
        }).then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>{
            <span class="keyword">if</span> (data.status === <span class="string">"done"</span>) {
                resolve(data);
            } <span class="keyword">else</span> {
                setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
                    resolve(getResult(url));
                }, <span class="number">1000</span>);
            }
        })
    })
}
</code></pre>
<h4 id="example">Example</h4>
<p>The following <code>request-body</code>can be used to execute the <a href="http://divaservices.unifr.ch/api/v2/binarization/otsubinarization/1">Otsu Binarization</a> on&nbsp;DIVAServices.</p>
<pre><code class="lang-JSON">{
  <span class="attr">"parameters"</span>:{},
  <span class="attr">"data"</span>:[
    {
      <span class="attr">"inputImage"</span>:<span class="string">"testCollection/ubb-A-<span class="caps">II</span>-0004_0002r.jpeg"</span>
      }
  ]
}
</code></pre>
<h2 id="data-collection-endpoints">Data / Collection&nbsp;Endpoints</h2>
<h3 id="get-collections"><span class="caps">GET</span>&nbsp;/collections</h3>
<p>Provides a list of all existing collections. The returned <span class="caps">JSON</span> object is structured as&nbsp;follows:</p>
<pre><code class="lang-JSON">{
  <span class="attr">"collections"</span>: [
    {
      <span class="attr">"collection"</span>: {
        <span class="attr">"name"</span>: <span class="string">"irritatingflickeringpitbull"</span>,
        <span class="attr">"url"</span>: <span class="string">"http://divaservices.unifr.ch/api/v2/collections/irritatingflickeringpitbull"</span>
      }
    },
    {
      <span class="attr">"collection"</span>: {
        <span class="attr">"name"</span>: <span class="string">"dopeyscholarlykentrosaurus"</span>,
        <span class="attr">"url"</span>: <span class="string">"http://divaservices.unifr.ch/api/v2/collections/dopeyscholarlykentrosaurus"</span>
      }
    }
  ]
</code></pre>
<p>Each collection has a <code>name</code> and an <code>url</code> under which more information can be fetched&nbsp;from.</p>
<h3 id="post-collections"><span class="caps">POST</span>&nbsp;/collections</h3>
<p>Creates a new collection. The <code>request-body</code> to create a new collection has to look as&nbsp;follows:</p>
<pre><code class="lang-JSON">{
  <span class="attr">"name"</span>: <span class="string">"ocr_models"</span>,
  <span class="attr">"files"</span>:[
    {
      <span class="attr">"type"</span>:<span class="string">"url"</span>,
      <span class="attr">"value"</span>:<span class="string">"http://www.tmbdev.net/en-default.pyrnn.gz"</span>,
      <span class="attr">"name"</span>:<span class="string">"english.gz"</span>
    }
  ]
}
</code></pre>
<p>The following information needs to be&nbsp;provided:</p>
<ul>
<li><code>name</code> (optional): The identifier of this collection. If none provided a random one is&nbsp;generated.</li>
<li><code>files</code>: An array of files that should be added to this&nbsp;collection.</li>
</ul>
<p>Each entry of <code>files</code> is structured as&nbsp;follows:</p>
<ul>
<li><code>type</code>: the type of file that is provided, can be <code>url</code> or <code>file</code></li>
<li><code>value</code>: The value for the&nbsp;file.</li>
<li><code>name</code>: The filename the filename should have within the collection (complete filename&nbsp;needed)</li>
</ul>
<p>The <code>value</code> depends on the <code>type</code> and the two following options are&nbsp;possible:</p>
<ul>
<li><code>type=url</code>: <code>value</code> points to the <span class="caps">URL</span> where the file can be downloaded&nbsp;from</li>
<li><code>type=file</code>: <code>value</code> is the <code>base64</code> encrypted content of the&nbsp;file</li>
</ul>
<p><strong>Note:</strong> The complete request can not be larger than <code>250mb</code>.</p>
<h3 id="get-collections-collectionname"><span class="caps">GET</span>&nbsp;/collections/:collectionname</h3>
<p>Provides detailed information about a collection. The returned <span class="caps">JSON</span> is structured as&nbsp;follows:</p>
<pre><code class="lang-JSON">{
  <span class="attr">"statusCode"</span>: <span class="number">200</span>,
  <span class="attr">"statusMessage"</span>: <span class="string">"Collection is available"</span>,
  <span class="attr">"percentage"</span>: <span class="number">100</span>,
  <span class="attr">"totalFiles"</span>: <span class="number">1</span>,
  <span class="attr">"files"</span>: [
    {
      <span class="attr">"file"</span>: {
        <span class="attr">"md5"</span>: <span class="string">"e816b16b11ee17a32ecaaf7b7a19b2c3"</span>,
        <span class="attr">"url"</span>: <span class="string">"http://divaservices.unifr.ch/api/v2/files/irritatingflickeringpitbull/original/inverseImage.jpg"</span>,
        <span class="attr">"identifier"</span>: <span class="string">"irritatingflickeringpitbull/inverseImage.jpg"</span>
      }
    }
  ]
}
</code></pre>
<p>The <code>files</code> array contains a <code>file</code> object for each file that is in this collection.
The <code>identifier</code> can be used as data reference when executing a&nbsp;method.</p>
<h3 id="put-collections-collectionname"><span class="caps">PUT</span>&nbsp;/collections/:collectionname</h3>
<p>Adds a file into a collection. The <code>request-body</code> needs to look as&nbsp;follows:</p>
<pre><code class="lang-JSON">{
  <span class="attr">"files"</span>:[
    {
      <span class="attr">"type"</span>:<span class="string">"url"</span>,
      <span class="attr">"value"</span>:<span class="string">"http://www.tmbdev.net/en-default.pyrnn.gz"</span>,
      <span class="attr">"name"</span>:<span class="string">"english.gz"</span>
    }
  ]
}
</code></pre>
<p>The same rules as in <a href="#post--collections"><span class="caps">POST</span> /collections</a> apply here&nbsp;too.</p>
</section>
      </div>
    </div>
    <hr class="clear">
    <div class="container footer">
      <div class="larger">
        <footer>
          <p><span>Made by </span><a href="https://diuf.unifr.ch/main/diva/" target="_blank">DIVA Group</a><span>.</span></p>
          <p>University of Fribourg (Switzerland)</p>
        </footer>
      </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.14.0/prism.min.js"></script>
  </body>
</html>